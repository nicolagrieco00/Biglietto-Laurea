<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ event.title }} â€“ {{ event.celebrant_name }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
  <div class="bg"></div>
  <main class="canvas">
    <h2 class="line title">{{ event.title }}</h2>
    <h1 class="line name">{{ event.celebrant_name }}</h1>
    <p class="line for">per {{ event.degree }}</p>
    <p class="line when">{{ formatted_time }}</p>
    <p class="line where">{{ event.venue }}</p>
    <p class="line addr">{{ event.address }}</p>

    <div class="cta">
      <!-- fallback href per sicurezza -->
      <a id="waShare" class="btn" href="#" target="_blank" rel="noreferrer">Condividi su WhatsApp</a>
      <a class="btn" href="{{ event.gmaps_url }}" target="_blank" rel="noreferrer">Apri su Google Maps</a>
      <a class="btn" href="{{ event.rsvp_whatsapp }}" target="_blank" rel="noreferrer">RSVP su WhatsApp</a>
      <a class="btn" href="/download.ics">Aggiungi al Calendario (.ics)</a>
      <a class="btn" href="/qr.png{% if guest %}?guest={{ guest }}{% endif %}" target="_blank">QR dell'invito</a>
    </div>
    <button id="soundBtn" class="btn sound">ðŸ”Š Attiva suoni</button>
  </main>

  <div id="fxLayer"></div>
  <script src="{{ url_for('static', filename='script.js') }}"></script>

  <!-- ðŸ‘‡ FIX: inizializza il link di condivisione con i dati reali -->
  <script>
    (function () {
      const url = window.location.href;
      const msg = `Sei invitato alla festa di laurea di {{ event.celebrant_name }}!` + "\\n\\n" +
                  `{{ event.title }} â€“ {{ event.degree }}` + "\\n" +
                  `{{ formatted_time }}` + "\\n" +
                  `{{ event.venue }} â€“ {{ event.address }}` + "\\n" +
                  `Apri l'invito qui: ${url}` + "\\n" +
                  `Grazie!`;
      const a = document.getElementById('waShare');
      if (a) {
        a.href = "https://wa.me/?text=" + encodeURIComponent(msg);
      }
    })();
  </script>
</body>
</html>
