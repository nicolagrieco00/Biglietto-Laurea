<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ event.title }} â€“ {{ event.celebrant_name }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Great+Vibes&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta name="theme-color" content="#fff8f6">
</head>
<body>
  <main class="wrap">
    <div class="frame">
      <img src="{{ url_for('static', filename='rose-red.svg') }}" class="rose rose-tl" alt="rose">
      <img src="{{ url_for('static', filename='rose-red.svg') }}" class="rose rose-tr" alt="rose">
      <img src="{{ url_for('static', filename='rose-red.svg') }}" class="rose rose-bl" alt="rose">
      <img src="{{ url_for('static', filename='rose-red.svg') }}" class="rose rose-br" alt="rose">

      <section class="text">
        <h2 class="kicker">Ãˆ una festa di laurea!</h2>
        <h1 class="name">{{ event.celebrant_name }}</h1>
        <p class="for">per {{ event.degree }}</p>

        <p class="when">{{ formatted_time }}</p>
        <p class="where">{{ event.venue }}</p>
        <p class="addr">{{ event.address }}</p>
        {% if guest %}<p class="hello">Caro/a <strong>{{ guest }}</strong>, sei invitato con gioia! ðŸŒ¹</p>{% endif %}
      </section>

      <section class="cta">
        <a id="waShare" class="btn" target="_blank" rel="noreferrer">Condividi su WhatsApp</a>
        <a class="btn" href="{{ event.gmaps_url }}" target="_blank" rel="noreferrer">Apri su Google Maps</a>
        <a class="btn" href="{{ event.rsvp_whatsapp }}" target="_blank" rel="noreferrer">RSVP su WhatsApp</a>
        <a class="btn" href="/download.ics">Aggiungi al Calendario (.ics)</a>
        <a class="btn" href="/qr.png{% if guest %}?guest={{ guest }}{% endif %}" target="_blank">QR dell'invito</a>
      </section>

      <section class="countdown" id="countdown">
        <div class="box"><div class="num" id="d">--</div><div class="label">Giorni</div></div>
        <div class="box"><div class="num" id="h">--</div><div class="label">Ore</div></div>
        <div class="box"><div class="num" id="m">--</div><div class="label">Min</div></div>
        <div class="box"><div class="num" id="s">--</div><div class="label">Sec</div></div>
      </section>
    </div>
  </main>

  <script>
    const startISO = "{{ start.isoformat() }}";
    function updateShareLink(){
      const url = window.location.href;
      const msg = `Sei invitato alla festa di laurea di {{ event.celebrant_name }}!\n\n{{ event.title }} â€“ {{ event.degree }}\n{{ formatted_time }}\n{{ event.venue }} â€“ {{ event.address }}\nApri l'invito qui: ${url}\nGrazie!`;
      document.getElementById('waShare').href = "https://wa.me/?text=" + encodeURIComponent(msg);
    }
    function pad(n){ return String(n).padStart(2,'0'); }
    function tick(){
      const startTime = new Date(startISO).getTime();
      const diff = Math.max(0, startTime - Date.now());
      const d = Math.floor(diff / (1000*60*60*24));
      const h = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const m = Math.floor((diff % (1000*60*60)) / (1000*60));
      const s = Math.floor((diff % (1000*60)) / 1000);
      d_el.textContent = pad(d); h_el.textContent = pad(h); m_el.textContent = pad(m); s_el.textContent = pad(s);
    }
    const d_el = document.getElementById('d'), h_el = document.getElementById('h'), m_el = document.getElementById('m'), s_el = document.getElementById('s');
    updateShareLink(); setInterval(tick, 1000); tick();
  </script>
</body>
</html>
